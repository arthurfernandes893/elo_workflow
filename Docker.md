# Containerizing the Application with Docker

This guide provides step-by-step instructions to containerize this Python application using Docker. This process will create a portable Docker image that can be run on any machine with Docker installed.

## Step 1: Create the `.dockerignore` file

To keep the Docker image small and to avoid including unnecessary or sensitive files, create a file named `.dockerignore` in the project root with the following content. This file tells Docker which files and directories to exclude from the image build process.

```
# Git
.git
.gitignore

# Docker
Dockerfile
.dockerignore

# Virtualenv
.venv
venv

# Python cache
__pycache__
*.pyc
*.pyo
*.pyd

# IDEs & OS-specific
.idea
.vscode
.DS_Store

# Backups & Data
backup_bases/
base_dados/
entrada_dados/
*.db
*.bak*
```

## Step 2: Create the `Dockerfile`

The `Dockerfile` contains the instructions for building the application image. Create a file named `Dockerfile` in the project root with the following content:

```dockerfile
# Use an official Python runtime as a parent image
# Using python:3.12-slim as it is a lightweight version of the python image
FROM python:3.12-slim

# Set the working directory in the container
WORKDIR /app

# Copy the requirements file and install dependencies
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# Copy the rest of the application code into the container
COPY . .

# Expose the port that Streamlit runs on
EXPOSE 8501

# The command to run when the container starts
CMD ["streamlit", "run", "app_dashboard.py"]
```

### Explanation of the `Dockerfile`:
- **`FROM python:3.12-slim`**: Specifies the official lightweight Python 3.12 image as the base for our image.
- **`WORKDIR /app`**: Sets the working directory inside the container to `/app`. All subsequent commands will be run from this directory.
- **`COPY requirements.txt .`**: Copies the dependencies file into the container.
- **`RUN pip install --no-cache-dir -r requirements.txt`**: Installs the Python dependencies listed in `requirements.txt`. The `--no-cache-dir` flag is used to reduce the image size.
- **`COPY . .`**: Copies the rest of the application source code into the `/app` directory in the container.
- **`EXPOSE 8501`**: Informs Docker that the container will listen on port 8501 at runtime. This is the default port for Streamlit applications.
- **`CMD ["streamlit", "run", "app_dashboard.py"]`**: Specifies the default command to execute when the container starts.

## Step 3: Build the Docker Image

Open your terminal, navigate to the project's root directory, and run the following command to build the Docker image. The `-t` flag tags the image with a name (`automacao-acolhimento`) for easy reference.

```bash
docker build -t automacao-acolhimento .
```

## Step 4: Run the Docker Container

To run the application, you need to execute the `docker run` command. It is crucial to use **volumes** (`-v` flag) to map the data directories from your host machine to the container. This ensures that any data generated by the application (like databases or backups) is stored on your machine and persists even after the container is stopped or removed.

```bash
docker run -p 8501:8501 \
  -v /Users/arthur/code/pibi/automacao_acolhimento/automacao_acolhimento/base_dados:/app/base_dados \
  -v /Users/arthur/code/pibi/automacao_acolhimento/automacao_acolhimento/entrada_dados:/app/entrada_dados \
  -v /Users/arthur/code/pibi/automacao_acolhimento/automacao_acolhimento/backup_bases:/app/backup_bases \
  automacao-acolhimento
```

### Explanation of the `docker run` command:
- **`-p 8501:8501`**: Maps port 8501 on your host machine to port 8501 in the container, allowing you to access the Streamlit app from your browser.
- **`-v /path/on/host:/path/in/container`**: This flag mounts a host directory into the container. We are mapping `base_dados`, `entrada_dados`, and `backup_bases` so that the application can read and write data persistently.
- **`automacao-acolhimento`**: The name of the image to run.

Once the container is running, you can access your application by navigating to **`http://localhost:8501`** in your web browser.
